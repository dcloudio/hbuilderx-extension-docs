# Github Copilot for HBuilder 插件使用说明

## 简介

本插件旨在将 GitHub Copilot 的代码自动补全功能集成到 HBuilderX IDE 中，为开发者提供行内代码建议，从而提升编码效率。它通过连接到 GitHub Copilot 的官方语言服务器，实时获取代码补全建议。  
要了解更多 GitHub Copilot 信息，请访问 [https://github.com/features/copilot](https://github.com/features/copilot).

## 环境要求

- **HBuilderX**: 版本 `4.71` 或更高。
- **Node.js**: 版本 `22` 或更高。插件需要一个独立的 Node.js 环境来运行 Copilot 语言服务器。

## 如何使用

### 1. 安装与激活
- 打开 HBuilderX 后，在菜单栏点击 `工具 -> 插件安装 ` 打开插件安装面板。
- 在插件安装面板中切换到 `安装新插件` 标签页，找到 `Github Copilot for HBuilder` 并点击 `安装` 按钮。
- 插件安装完毕后会自动激活。  

<img src="https://web-ext-storage.dcloud.net.cn/hx/doc/copilot-install.png" />

### 2. 首次配置

- 插件首次启动时，会检查 Node.js 环境。如果插件无法自动找到符合版本要求的 Node.js (≥22)，HBuilderX 会弹出提示，要求您进行配置。
- 您需要将您本地的 Node.js 可执行文件路径填入到 `设置 -> 插件配置 -> Github Copilot -> 指定Copilot语言服务端运行时的node可执行程序路径` 中。
- 正确配置后，插件会尝试启动 Copilot 语言服务。  

<img src="https://web-ext-storage.dcloud.net.cn/hx/doc/copilot-conf-node-path.png" />

### 3. 登录 GitHub Copilot
> 注意：在开始登录前，您需要拥有一个活跃的 Github 账户并订阅 GitHub Copilot 才能使用此插件，您可以通过此链接查看订阅状态: [https://github.com/settings/copilot/features](https://github.com/settings/copilot/features)。

- **状态栏图标**: 在 HBuilderX 右下角的状态栏会显示 Copilot 的图标。点击该图标可以打开 Copilot 状态面板。  
- **开始登录**: 在状态面板中，点击 `登录 Github` 按钮，插件会向 Github 发起登录请求，请求成功后会返回用于设备授权的 `设备码`。  
<img src="https://web-ext-storage.dcloud.net.cn/hx/doc/copilot-signin.png" />
- **设备授权**: 面板会显示一个设备码，并提供一个 GitHub 授权链接。点击 `复制并访问` 会将设备码复制到剪贴板并自动调用系统浏览器打开授权页面。  
<img src="https://web-ext-storage.dcloud.net.cn/hx/doc/copilot-device-code.png" />

- **完成授权**: 在浏览器打开的页面中，粘贴设备码并授权。授权成功后，插件会自动验证并完成登录。  
<img src="https://web-ext-storage.dcloud.net.cn/hx/doc/copilog-signin-ok.png" />

### 4. 获取代码建议

- 登录并启用成功后，在您编写代码（支持的语言文件中）时，Copilot 会自动提供行内代码建议。
- 按 `Tab` 键即可采纳建议。  
<img src="https://web-ext-storage.dcloud.net.cn/hx/doc/copilot-working.png" />

### 5. 状态管理

- 点击状态栏图标，可以打开状态面板，进行以下操作：
  - **登入/登出**: 管理您的 GitHub 账号登录状态。
  - **启用/禁用**: 全局启用或禁用 Copilot 功能。
  - **语言设置**: 直接在面板中修改语言启用配置。
  - **查看额度**: 在面板右下角可查看您的账户中代码自动补全功能剩余的使用额度。

## 配置项说明

您可以在 `设置 -> 插件配置 -> GitHub Copilot` 中找到以下配置项：

- **`Copilot状态显示`**: 控制状态栏图标的显示方式。
  - `自动`: 自动模式。
  - `仅图标`: 仅显示图标。
  - `图标+文本`: 显示图标和文字 "Copilot"。
- **`启用或禁用Copilot行内自动补全`**: 全局启用或禁用此插件的代码自动补全功能。
  - `勾选`: 启用 (默认)。
  - `未勾选`: 禁用。
- **`配置指定语言的自动补全`**: 配置在哪些语言中启用代码补全。
  - 格式为 `languageId=true/false`，多个配置用逗号 `,` 分隔。
  - 例如: `*=true,markdown=false` 表示为所有语言启用，但 markdown 文件除外。
- **`指定Copilot语言服务端运行时的node可执行程序路径`**: 指定运行 Copilot 语言服务所需的 Node.js 可执行文件路径。
  - **重要**: 请确保此路径指向的 Node.js 版本不低于 22.0。

## 注意事项

- **GitHub Copilot 订阅**: 您需要拥有一个活跃的 Github 账户并订阅 GitHub Copilot 才能使用此插件，您可以通过此链接查看有关 Github Copilot 的订阅状态: [https://github.com/settings/copilot/features](https://github.com/settings/copilot/features)。
- **网络连接**: 插件需要稳定的网络连接以访问 GitHub Copilot 服务。如果您的网络环境需要代理（科学上网），请确保正确配置了网络代理。
- **登录超时**: 设备授权流程有时间限制（通常为15分钟），请在设备码过期前完成授权。
- **错误排查**: 如果遇到问题，可以打开 HBuilderX 的开发日志 (`帮助 -> 查看运行日志`)，在日志中查看有关 "Copilot Server" 或 "Copilot Log Message" 的输出以获取详细错误信息。
- **手动安装**: 如果您是通过将插件zip包解压到HBuilderX的plugins目录的方式安装插件，请务必保证插件根目录的名称与`package.json`中`id`的内容保持一致，否则将导致插件激活失败。

## 常见问题

**Q: 点击登录后失败或长时间无响应怎么办？**

A: 这通常由以下几种原因造成：
1.  **网络问题**: 这是最常见的原因。插件无法连接到 GitHub 的授权服务器（需要科学上网）。请检查您的网络连接、防火墙或代理设置，确保可以正常访问 `https://github.com`。日志中可能会出现 "无法访问 https://github.com/" 或 "request timed out" 等错误。
2.  **设备码过期或授权被拒**: 网页授权过程有时间限制，若操作超时设备码会失效。另外，如果您在 GitHub 页面上手动拒绝了授权，登录也会失败。请重新尝试登录流程。

**Q: 为什么我看不到任何代码建议？**

A: 请按以下步骤排查：
1.  检查状态栏图标，确保您已成功登录并且 Copilot 处于启用状态。
2.  确认当前文件的语言在 `配置指定语言的自动补全` 配置中是启用的。
3.  检查您的网络连接是否正常。
4.  查看 HBuilderX 的开发日志，确认是否有来自 Copilot 服务的错误信息。

**Q: 状态栏图标显示为禁用或警告状态，这是什么意思？**

A:
- **禁用图标**: 表示插件被全局禁用，或者当前文件所属的语言被禁用了。
- **警告图标**: 通常表示与 Copilot 服务的通信出现了问题，例如网络错误或请求失败。
- 点击图标打开状态面板可以获取更详细的状态信息。

**Q: 插件启动失败，提示 "node" 相关错误。**

A: 这是因为插件未能找到合适的 Node.js 运行环境。请确保您已安装 **Node.js v22 或更高版本**，并在插件设置 `GithubCopilot.node.path` 中正确填写了它的可执行文件路径。

**Q: 如何登出我的 GitHub 账号？**

A: 点击状态栏的 Copilot 图标打开状态面板，然后点击 "登出" 链接即可。
